<!-- Content pagina -->
<div class="container-fluid">
	<div class="page-header">
		<h1 class="text-titles"><i class="zmdi zmdi-money-box zmdi-hc-fw"></i> Registro <small>Profesor</small></h1>
	</div>
	<p class="lead">Rellenando el siguiente formulario podremos añadir al sistema un nuevo profesor.Este proceso solo podrá realizarlo el administrador</p>
</div>
<div class="container-fluid">
	<div class="row">
		<div class="col-xs-12">
			<ul class="nav nav-tabs" style="margin-bottom: 15px;">
				<li class="active"><a href="#new" data-toggle="tab">Nuevo</a></li>
				<li><a href="/profesores">Listado de Profesores</a></li>
			</ul>
			<div id="myTabContent" class="tab-content">
				<div class="tab-pane fade active in" id="new">
					<div class="container-fluid">
						<div class="row">
							<div class="col-xs-12 col-md-10 col-md-offset-1">
								<form method="post">
									<div class="form-group label-floating">
										<label class="control-label">Nombre</label>
										<input class="form-control" name="firstName" type="text">
									</div>
									<div class="form-group label-floating">
										<label class="control-label">Apellidos</label>
										<input class="form-control" name="lastName" type="text">
									</div>
									<div class="form-group label-floating">
										<label class="control-label">Codigo profesor</label>
										<input class="form-control" name="codigo" type="text">
										</div>
									<div class="form-group label-floating">
										<label class="control-label">email</label>
										<input class="form-control" name="email" type="email">
										</div>
									<div class="form-group label-floating">
										<label class="control-label">Contraseña</label>
										<input class="form-control" name="password" type="password">
										</div>
									<div class="form-group label-floating">
										<label class="control-label">Escriba de nuevo su contraseña</label>
										<input class="form-control" name="password2" type="password">
										</div>
									<div class="form-group label-floating">
										<label class="control-label">telefono</label>
										<textarea class="form-control" name="phone" ></textarea>
									</div>
									<div class="form-group label-floating">
										<label class="control-label">telefono opcional</label>
										<textarea class="form-control" name="phone2" ></textarea>
									</div>
									<div class="form-group">
										<label class="control-label">Tutor</label>
										<select class="form-control" name="tutor" id="tutor"  >
										   <option value="si">si</option>
										   <option value="no">no</option>
										</select>

									<div class="form-group">
										<label class="control-label">Etapa del tutor</label>
										<select class="form-control" name="tutor_etapa" id="tutor_etapa"  >
										   <option disabled selected>-----</option>>
										</select>

									<div class="form-group">
										<label class="control-label">Ciclo o curso del tutor</label>
										<select class="form-control" name="tutor_ciclo" id="tutor_ciclo"  >
										   <option disabled selected>-----</option>
										</select>
									</div>
									
									<div class="form-group">
										<label class="control-label"> Numero del curso tutor </label>
										<select class="form-control" name="tutor_curso" id="tutor_curso"  >
										   <option disabled selected>-----</option>
										</select>
									</div>

									<div class="form-group">
										<label class="control-label">Jefe de departamento</label>
										<select class="form-control" name="jefe_departamento">
											<option disabled selected>-----</option>
											<option value="true">Si</option>
											<option value="false">No</option>
										</select>
									</div>
									<!--DIRECCION-->
										<div class="form-group label-floating">
										<label class="control-label">calle</label>
										<textarea class="form-control" name="calle" ></textarea>
									</div>
										<div class="form-group label-floating">
										<label class="control-label">tipo_via</label>
										<textarea class="form-control" name="tipo_via" ></textarea>
									</div>
										<div class="form-group label-floating">
										<label class="control-label">n_via</label>
										<textarea class="form-control" name="n_via" ></textarea>
									</div>
										<div class="form-group label-floating">
										<label class="control-label">portal</label>
										<textarea class="form-control" name="portal" ></textarea>
									</div>
										<div class="form-group label-floating">
										<label class="control-label">puerta</label>
										<textarea class="form-control" name="puerta" ></textarea>
									</div>
										<div class="form-group label-floating">
										<label class="control-label">escalera</label>
										<textarea class="form-control" name="escalera" ></textarea>
									</div>
										<div class="form-group label-floating">
										<label class="control-label">bloque</label>
										<textarea class="form-control" name="bloque" ></textarea>
									</div>
									<!--PROVINCIA Y LOCALIDAD-->
									<div class="form-group">
										<label  class="control-label">Provincia</label>
										<select class="form-control" name="province" id="province">
											<option disabled selected>Seleccione una provincia</option>
										</select>

									<div class="form-group">
										<label  class="control-label">Localidad</label>
										<select class="form-control" name="city" id="city" >
											<option selected disabled>---</option>
										</select>
									<p class="text-center">
										<button class="btn btn-info btn-raised btn-sm"><i class="zmdi zmdi-floppy"></i> Save</button>
									</p>
								</form>
							</div>
						</div>
					</div>
				</div>
				<div class="tab-pane fade" id="list">
					<div class="table-responsive">
						
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!--SCRIPT PARA LOCALIDAD Y PROVINCIA-->

<script>

	(async () => {
            const province = document.querySelector("#province");
            const city = document.querySelector("#city");
            const responseProvinces = await fetch('/select_province');
            const provinces = await responseProvinces.json();
            provinces.map(p => {
                let opt = document.createElement('option');
                opt.value = p._id;
                opt.innerText = p.showName;
                province.appendChild(opt);
            })
            province.addEventListener("change", async () => {
                const currentProvince = province.value;
                let responseCities = await fetch(`/select_city/${currentProvince}`);
                currentCities = await responseCities.json();
                
                if(!currentCities) return alert('No existe esa provincia!');
                
                city.removeAttribute('disabled');
                city.innerHTML = '';
                let disabledOptCity = document.createElement('option');
                disabledOptCity.innerHTML = '---';
                disabledOptCity.setAttribute('disabled', true);
                disabledOptCity.setAttribute('selected', true);
                city.appendChild(disabledOptCity);
                currentCities.map( c => {
                    let opt = document.createElement('option');
                    opt.value = c._id;
                    opt.innerText = c.name;
                    console.log(c);
                    city.appendChild(opt);
                })
            })
        })()
</script> 


<!-- SCRIPT PARA TUTOR -->

<script>

(async () => {

            const tutor_el = document.querySelector("#tutor");
            const tutor_etapa_el = document.querySelector("#tutor_etapa");
			const tutor_ciclo_el = document.querySelector("#tutor_ciclo");
            const tutor_curso_el = document.querySelector("#tutor_curso");

            const responseEtapa  = await fetch('/select_etapa');
            const etapa = await responseEtapa.json();
            etapa.map(e => {
                let opt = document.createElement('option');
                opt.value = e._id;
                opt.dataset.cursos = e.n_cursos;
                opt.innerText = e.nombre_etapa;
                tutor_etapa_el.appendChild(opt);
            })

            etapaEl.addEventListener("change", async (event) => {
              const currentEtapa = etapaEl.value;
              const n_cursos_etapa = event.target.options[event.target.selectedIndex].dataset.cursos;


              let responseFP = await fetch(`/select_fp/${currentEtapa}`);
              currentFP = await responseFP.json();

              console.log(currentFP.length > 0)

              if(currentFP.length > 0) {
                console.log('Enabled')
                fp.disabled = false;
              } else {
                console.log('Disabled')
                fp.disabled = true
              }

              n_cursosEl.innerHTML = '';

              let disabledCurso = document.createElement('option');
              disabledCurso.innerText = '---';
              disabledCurso.setAttribute('disabled', true);
              disabledCurso.setAttribute('selected', true);
              n_cursosEl.appendChild(disabledCurso);

              for(let i = 1; i <= parseInt(n_cursos_etapa); i++) {
                const opt = document.createElement('option');
                opt.value = i;
                opt.innerText = `${i}º`;
                n_cursosEl.appendChild(opt);
              }
              
              if(!currentFP) return alert('No existe ese FP!');
              
              fp.innerHTML = '';
              let disabledOptFP = document.createElement('option');
              disabledOptFP.innerHTML = '---';
              disabledOptFP.setAttribute('disabled', true);
              disabledOptFP.setAttribute('selected', true);
              fp.appendChild(disabledOptFP);
              currentFP.map( f => {
                  let opt = document.createElement('option');
                  opt.value = f._id;
                  opt.innerText = f.nombre_fp;
                  fp.appendChild(opt);
              })
            })

            etapaEl.addEventListener("change", async () => {
                const currentEtapa = etapaEl.value;
                let responseCursos = await fetch(`/select_cursos/${currentEtapa}`);
                responseCursos = await responseCursos.json();
                
                if(!responseCursos) return alert('No existe ese Curso');
                
                fp.removeAttribute('disabled');
                fp.innerHTML = '';
                let disabledOptFP = document.createElement('option');
                disabledOptFP.innerHTML = '---';
                disabledOptFP.setAttribute('disabled', true);
                disabledOptFP.setAttribute('selected', true);
                fp.appendChild(disabledOptFP);
                responseCursos.map( f => {
                    let opt = document.createElement('option');
                    opt.value = f._id;
                    opt.innerText = f.nombre_fp;
                    console.log(f);
                    fp.appendChild(opt);
                })
            })
            

        })
  ()
</script> 